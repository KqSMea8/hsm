'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ("value" in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
        }
    }return function (Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
    };
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }return call && ((typeof call === "undefined" ? "undefined" : _typeof(call)) === "object" || typeof call === "function") ? call : self;
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : _typeof(superClass)));
    }subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
}

var user_hair = function (_Page) {
    _inherits(user_hair, _Page);

    function user_hair(hash) {
        _classCallCheck(this, user_hair);

        var css = '\n<style>\n    #index_vue .titleBar,#user_hair_vue .titleBar{height:10%;background:#fff}\n    #index_vue .titleBar>div,#user_hair_vue .titleBar>div{float:left;height:100%;text-align:center;width:30%}\n    #index_vue .titleBar>table,#user_hair_vue .titleBar>table{height:100%;width:20%;float:left}\n    #index_vue .titleBar>table td,#user_hair_vue .titleBar>table td{text-align:center;font-size:3vw;padding:0 4%}\n    #index_vue .titleBar_title,#user_hair_vue .titleBar_title{height:100%;width:100%}\n    #index_vue .titleBar_title span,#user_hair_vue .titleBar_title span{font-size:4.5vw;}\n    #index_vue .titleBar .glyphicon-chevron-left{transform:rotate(90deg);transition:all .4s ease}\n    #index_vue .titleBar .rotate{transform:rotate(-90deg)}\n    #index_vue .search{width:36%}\n    #index_vue .yueta{height:80%}\n    #user_hair_vue .yueta{height:90%}\n    #index_vue .yueta .person,#user_hair_vue .yueta .person{overflow:scroll;-webkit-overflow-scrolling:touch;width:100%;height:100%;position:relative}\n    #index_vue .yueta .store,#user_hair_vue .yueta .store{overflow:scroll;-webkit-overflow-scrolling:touch;width:100%;height:100%;position:relative}\n    #index_vue .footBar{width:100%;background:#fff;height:10%}\n    .red{color:red}\n    .grey{color:#777}\n    .border_bottom_red{border-bottom:solid 2px red}\n    #index_vue .info_box,#user_hair_vue .info_box{margin:3%;background:#fff}\n    #index_vue .info_box>div,#user_hair_vue .info_box>div{background:#fff}\n    #index_vue .info_box .line1,#user_hair_vue .info_box .line1{padding:3% 0;font-size:4vw}\n    #index_vue .info_box .name,#user_hair_vue .info_box .name{font-weight:900;font-size: 4vw;}\n    #index_vue .info_box .userHairHistory,#user_hair_vue .info_box .userHairHistory{width:19%;color:#aaa}\n    #index_vue .info_box .waitting,#user_hair_vue .info_box .waitting{text-align:right}\n    #index_vue .footBar>div{width:50%;float:left;height:100%;text-align:center}\n    #index_vue .footBar>div>div{height:60%}\n    #index_vue .footBar img{height:80%;top:20%;position:relative}\n    #index_vue .info_box ul,#user_hair_vue .info_box ul{position:relative;width:100%;background:#fff}\n    #index_vue .info_box li,#user_hair_vue .info_box li{float:left}\n    #index_vue .info_box ul.block,#user_hair_vue .info_box ul.block{height:auto}\n    #index_vue .info_box ul:nth-of-type(1) li,#user_hair_vue .info_box ul:nth-of-type(1) li{width:50%;height:100%}\n    #index_vue .info_box ul:nth-of-type(1) li:nth-of-type(2),#user_hair_vue .info_box ul:nth-of-type(1) li:nth-of-type(2){text-align:right}\n    #index_vue .info_box ul:nth-of-type(1) span,#user_hair_vue .info_box ul:nth-of-type(1) span{font-size:17px}\n    #index_vue .info_box ul:nth-of-type(1) span.name,#user_hair_vue .info_box ul:nth-of-type(1) span.name{font-size:18px;font-weight:900}\n    #index_vue .info_box ul:nth-of-type(3) li,#user_hair_vue .info_box ul:nth-of-type(3) li{width:50%;height:100%}\n    #index_vue .info_box ul:nth-of-type(3) li:nth-of-type(2),#user_hair_vue .info_box ul:nth-of-type(3) li:nth-of-type(2){text-align:right}\n    #index_vue .info_box ul:nth-of-type(3) img,#index_vue .info_box ul:nth-of-type(4) img,#user_hair_vue .info_box ul:nth-of-type(3) img{height:38%;top:28%;position:relative}\n    #index_vue .info_box ul:nth-of-type(3) span,#user_hair_vue .info_box ul:nth-of-type(3) span{font-size:16px}\n    #index_vue .info_box ul:nth-of-type(4) li,#user_hair_vue .info_box ul:nth-of-type(4) li{width:50%;height:100%}\n    #index_vue .info_box ul:nth-of-type(4) li:nth-of-type(2),#user_hair_vue .info_box ul:nth-of-type(4) li:nth-of-type(2){text-align:right}\n    #index_vue .info_box ul:nth-of-type(4) span,#user_hair_vue .info_box ul:nth-of-type(4) span{font-size:16px}\n    .pink{color:pink}\n    .borderRed{border:1px solid red}\n    .borderPink{border:1px solid pink}\n    #index_vue .info_box .yijian,#user_hair_vue .info_box .yijian{border-radius: 53px;width: 58%;display: inline-block;text-align: center;position: relative;padding: 6% 2%;font-size: 3vw;margin-right: 10%;}\n    #index_vue .info_box .fans,#user_hair_vue .info_box .fans{bottom:4%;left:51%;width:46%;position:absolute;font-size: 3vw;}\n    #index_vue .info_box .fans td,#user_hair_vue .info_box .fans td{padding:2% 0;text-align:center;line-height:1.1;color:#fff}\n    #index_vue .info_box .fans td:nth-of-type(1),#user_hair_vue .info_box .fans td:nth-of-type(1){background:#D60040}\n    #index_vue .info_box .fans td:nth-of-type(2),#user_hair_vue .info_box .fans td:nth-of-type(2){background:#e60045}\n    #index_vue .info_box .distance,#user_hair_vue .info_box .distance{position:absolute;bottom:2%;font-size:4vw;color:grey;left:4%}\n    #user_hair_vue div{display: block;}\n</style>\n';
        var html = ["\n<div class=\"titleBar\">\n    <table>\n        <tr>\n            <td>&nbsp;</td>\n        </tr>\n    </table>\n    <div v-for=\"item in titleBar\" @touchstart=\"titleItemClick($index)\">\n        <table class=\"titleBar_title {{item.status?'red border_bottom_red':'grey'}}\">\n            <tr>\n                <td>\n                    {{item.text}}\n                </td>\n            </tr>\n        </table>\n    </div>\n    <table>\n        <tr>\n            <td>&nbsp;</td>\n        </tr>\n    </table>\n</div>\n<div class=\"yueta\">\n    <div class=\"store\" style=\"{{titleBar[0].status?'':'display: none;'}}\">\n        <div class=\"info_box\" v-for=\"userHairReference in userHairReferenceList\" style=\"display: block;\">\n            <table class=\"w100\">\n                <tr>\n                    <td class=\"line1 name w50\" v-html=\"'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + userHairReference.studio_name + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + userHairReference.barber_name\"></td>\n                    <td style=\"font-size:10px;\" class=\"line1 w50 txtr grey\">\n                        {{userHairReference.create_time}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                    </td>\n                </tr>\n            </table>\n            <ul class=\"block\">\n                <img v-for=\"i in userHairReference.img\" class=\"w100\" style=\"width: 25%;\" :src=\"userHairReference.img[$index]\" @click=\"look(userHairReference.img[$index], userHairReference.img)\"/>\n            </ul>\n            <table class=\"w100\">\n                <tr>\n                    <td class=\"line1 w50 txtr\">\n                        &nbsp;&nbsp;\n                        <b class=\"red\" style=\"font-family: \u9ED1\u4F53;\" @click=\"confirmCancelUserHairReference(userHairReference.id)\">\n                            &nbsp;&nbsp;\u53D6\u6D88\u5F53\u524D\u53C2\u8003\u53D1\u578B>\n                        </b>\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n    <div class=\"store\" style=\"{{titleBar[1].status?'':'display: none;'}}\">\n        <div class=\"info_box\" v-for=\"userHairHistory in userHairHistoryList\" style=\"display: block;\">\n            <table class=\"w100\">\n                <tr>\n                    <td class=\"line1 name w50\" v-html=\"'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + userHairHistory.studio_name + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + userHairHistory.barber_name\"></td>\n                    <td style=\"font-size:10px;\" class=\"line1 w50 txtr grey\">\n                        {{userHairHistory.create_time}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                    </td>\n                </tr>\n            </table>\n            <ul class=\"block\">\n                <img v-for=\"i in userHairHistory.img\" class=\"w100\" style=\"width: 25%;\" :src=\"userHairHistory.img[$index]\" @click=\"look(userHairHistory.img[$index], userHairHistory.img)\"/>\n            </ul>\n            <table class=\"w100\">\n                <tr>\n                    <td class=\"line1 w50 txtr\">\n                        &nbsp;&nbsp;\n                        <b class=\"red\" style=\"font-family: \u9ED1\u4F53;\" v-if=\"userHairHistory.hair_id == null\" @click=\"setUserHairReference(userHairHistory.oid, userHairHistory.uid, userHairHistory.img)\">\n                            &nbsp;&nbsp;\u8BBE\u7F6E\u6210\u53C2\u8003\u53D1\u578B>\n                        </b>\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n</div>\n<div class=\"endtouch w100 h100 pos_a t0\"></div>\n"];
        return _possibleConstructorReturn(this, (user_hair.__proto__ || Object.getPrototypeOf(user_hair)).call(this, hash, html, css));
    }

    _createClass(user_hair, [{
        key: 'vue_',
        value: function vue_() {
            this.vue = new VueP({
                el: this.hash + '_vue',
                created: function created() {
                    this.launcher = launcher.vue;
                    this.db = db;
                },
                compiled: function compiled() {},

                data: {
                    titleBar: [{ text: '我的参考发型', status: false }, { text: '发型历史', status: true }],
                    userHairHistoryList: [],
                    userHairReferenceList: [],
                    oid: 0,
                    uid: 0,
                    img: "",
                    hid: 0
                },
                methods: {
                    init: function init() {
                        var _this2 = this;

                        setTimeout(function () {
                            _this2.launcher.showAndHideCover($(_this2.$el));
                        }, 100);
                        var dataStr = '{\n                        "uid":' + this.db.data.setUserId + '\n                    }';
                        Util.ajax(dataStr, db.data.api + 'getUserHairHistoryList.php', function (data) {
                            _this2.renderUserHairHistoryList(data);
                            Util.ajax(dataStr, db.data.api + 'getUserHairReferenceList.php', function (data) {
                                _this2.renderUserHairReferenceList(data);
                            });
                        });
                    },
                    renderUserHairHistoryList: function renderUserHairHistoryList(data) {
                        if (data.e !== 0) {} else {
                            this.userHairHistoryList = data.data.userHairHistoryList;
                            for (var key in this.userHairHistoryList) {
                                var imgArr = [];
                                var img = "";
                                img = this.userHairHistoryList[key].img + "";
                                imgArr = img.split("|");
                                this.userHairHistoryList[key].img = imgArr;
                            }
                        }
                    },
                    renderUserHairReferenceList: function renderUserHairReferenceList(data) {
                        if (data.e !== 0) {} else {
                            this.userHairReferenceList = data.data.userHairReferenceList;
                            for (var key in this.userHairReferenceList) {
                                var imgArr = [];
                                var img = "";
                                img = this.userHairReferenceList[key].img + "";
                                imgArr = img.split("|");
                                this.userHairReferenceList[key].img = imgArr;
                            }
                        }
                    },
                    titleItemClick: function titleItemClick(index) {
                        if (!this.titleBar[index].status) {
                            var length, i;
                            length = this.titleBar.length;
                            for (i = 0; i < length; i++) {
                                if (index != i) {
                                    this.titleBar[i].status = false;
                                }
                            }
                            this.titleBar[index].status = true;
                        }
                    },
                    look: function look(currentImg, imgStr) {
                        var imgString = "";
                        imgString = imgStr + "";
                        var imgArr = imgString.split(",");
                        var urls = [];
                        for (var i = 0; i < imgArr.length; i++) {
                            var src = imgArr[i].trim();
                            if (!!src) {
                                urls.push(src);
                            }
                        }
                        if (urls.length <= 0) {
                            return;
                        } else {
                            wx.previewImage({
                                current: currentImg, // 当前显示图片的http链接
                                urls: urls // 需要预览的图片http链接列表
                            });
                        }
                    },
                    setUserHairReference: function setUserHairReference(oid, uid, img) {
                        var _this3 = this;

                        this.oid = oid;
                        this.uid = uid;
                        this.img = img;
                        var dataStr = '{\n                            "oid":"' + this.oid + '",\n                            "uid":"' + this.uid + '",\n                            "img":"' + this.img + '"\n                        }';
                        Util.ajax(dataStr, db.data.api + 'setUserHairReference.php', function (data) {
                            if (data.e !== 0) {
                                Message.toast('设置失败');
                            } else {
                                Message.toast('设置成功');
                                _this3.init();
                            }
                        });
                    },
                    confirmCancelUserHairReference: function confirmCancelUserHairReference(hid) {
                        var _tempThis = this;
                        MessageBarber.confirm('确定要取消当前参考发型吗?', function () {
                            _tempThis.cancelUserHairReference(hid);
                        });
                    },
                    cancelUserHairReference: function cancelUserHairReference(hid) {
                        var _this4 = this;

                        this.hid = hid;
                        var dataStr = '{\n                            "hid":"' + this.hid + '"\n                        }';
                        Util.ajax(dataStr, db.data.api + 'cancelUserHairReference.php', function (data) {
                            if (data.e !== 0) {
                                Message.toast('取消设置失败');
                            } else {
                                Message.toast('取消设置成功');
                                _this4.init();
                            }
                        });
                    }
                }
            });
        }
    }]);

    return user_hair;
}(Page);
//
