{"version":3,"sources":["../../../barber/pages/bind_phone.js"],"names":["bind_phone","hash","css","html","vue","VueP","el","created","compiled","data","showBindPhoneView","canSendPhoneCheck","checkText","phone","phoneCheck","timer12","methods","init","sendPhoneCheck","dataStr","_this","Util","ajax","db","api","e","launcher","handlerError","Message","toast","clearInterval","setInterval","num","Math","floor","substr","length","bindPhone","isMobileNumber","app","browser","die","user","setTimeout","location","href","Page"],"mappings":";;;;;;;;;;IACMA,U;;;AACF,wBAAYC,IAAZ,EAAiB;AAAA;;AACb,YAAIC,kqCAAJ;AAmBA,YAAIC,OACA,+xBADJ;AApBa,uHA4CPF,IA5CO,EA4CDE,IA5CC,EA4CKD,GA5CL;AA6ChB;;;;+BAEK;AACF,iBAAKE,GAAL,GAAW,IAAIC,IAAJ,CAAS;AAChBC,oBAAI,KAAKL,IAAL,GAAU,MADE;AAEhBM,uBAFgB,qBAEL,CAAE,CAFG;AAGhBC,wBAHgB,sBAGJ,CAAE,CAHE;;AAIhBC,sBAAM;AACFC,uCAAkB,KADhB;AAEFC,uCAAkB,IAFhB;AAGFC,+BAAU,SAHR;AAIFC,2BAAM,EAJJ;AAKFC,gCAAW,EALT;AAMFC,6BAAQ;AANN,iBAJU;AAYhBC,yBAAS;AACLC,wBADK,kBACC,CAEL,CAHI;AAILC,kCAJK,4BAIW;AACZ,4BAAIC,mDACW,KAAKN,KADhB,6BAAJ;AAGA,4BAAIO,QAAQ,IAAZ;AACAC,6BAAKC,IAAL,CAAUH,OAAV,EAAsBI,GAAGd,IAAH,CAAQe,GAA9B,mCAAiE,UAACf,IAAD,EAAU;AACvE,gCAAGA,KAAKgB,CAAL,KAAW,CAAd,EAAgB;AACZ,oCAAG,CAACC,SAAStB,GAAT,CAAauB,YAAb,CAA0BlB,KAAKgB,CAA/B,CAAJ,EACIG,QAAQC,KAAR,CAAc,QAAd,EAAwB,CAAxB;AACP,6BAHD,MAGK;AACDT,sCAAMR,SAAN,GAAkB,KAAlB;AACA,oCAAGQ,MAAML,OAAN,KAAkB,IAArB,EAA0B;AACtBe,kDAAcV,MAAML,OAApB;AACAK,0CAAML,OAAN,GAAgB,IAAhB;AACH;AACDK,sCAAML,OAAN,GAAgBgB,YAAY,YAAU;AAClC,wCAAIC,MAAMC,KAAKC,KAAL,CAAWd,MAAMR,SAAN,CAAgBuB,MAAhB,CAAuB,CAAvB,EAAyBf,MAAMR,SAAN,CAAgBwB,MAAhB,GAAuB,CAAhD,CAAX,IAA+D,CAAzE;AACA,wCAAGJ,MAAI,CAAP,EAAS;AACLF,sDAAcV,MAAML,OAApB;AACAK,8CAAML,OAAN,GAAgB,IAAhB;AACAK,8CAAMR,SAAN,GAAkB,SAAlB;AACH,qCAJD,MAIK;AACDQ,8CAAMR,SAAN,GAAkBoB,MAAM,GAAxB;AACH;AACJ,iCATe,EASd,IATc,CAAhB;AAUH;AACJ,yBArBD;AAsBH,qBA/BI;AAgCLK,6BAhCK,uBAgCM;AACP,4BAAG,CAAChB,KAAKiB,cAAL,CAAoB,KAAKzB,KAAzB,CAAJ,EACI,MAAM,UAAN;AACJ,4BAAG,CAAC,CAAC,KAAKC,UAAP,KAAsB,KAAzB,EACI,MAAM,SAAN;AACJ,4BAAIK,mDACW,KAAKN,KADhB,4CAEU,KAAKC,UAFf,6BAAJ;AAIA,4BAAIM,QAAQ,IAAZ;AACAC,6BAAKC,IAAL,CAAUH,OAAV,EAAsBI,GAAGd,IAAH,CAAQe,GAA9B,0BAAwD,UAACf,IAAD,EAAU;AAC9D,gCAAGA,KAAKgB,CAAL,KAAW,CAAd,EAAgB;AACZG,wCAAQC,KAAR,CAAc,OAAd,EAAuB,CAAvB;AACH,6BAFD,MAEK;AACDU,oCAAIC,OAAJ,CAAYC,GAAZ;AACAX,8CAAcV,MAAML,OAApB;AACAK,sCAAML,OAAN,GAAgB,IAAhB;AACAQ,mCAAGd,IAAH,CAAQiC,IAAR,CAAa7B,KAAb,GAAqBO,MAAMP,KAA3B;AACAO,sCAAMP,KAAN,GAAc,EAAd;AACAO,sCAAMN,UAAN,GAAmB,EAAnB;AACAM,sCAAMV,iBAAN,GAA0B,KAA1B;AACAU,sCAAMR,SAAN,GAAkB,SAAlB;AACAgB,wCAAQC,KAAR,CAAc,MAAd,EAAsB,CAAtB;AACAc,2CAAW,YAAU;AACjBC,6CAASC,IAAT;AACH,iCAFD,EAEE,IAFF;AAGH;AACJ,yBAjBD;AAkBH;AA5DI;AAZO,aAAT,CAAX;AA2EH;;;;EA5HoBC,I","file":"bind_phone.js","sourcesContent":["\r\nclass bind_phone extends Page {\r\n    constructor(hash){\r\n        let css =\r\n            `\r\n<style>\r\n.bindPhone{position:absolute;width:100%;height:100%;top:0}\r\n.bindPhone .cover{height:100%;width:100%;background:#000;opacity:.4}\r\n.bindPhone .box{width:94%;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;height:236px;background:#fff}\r\n.bindPhone input{padding:0;font-size:100%;outline:0;border:0;box-shadow:none;background-color:#f5f5f5}\r\n.bindPhone .box .line_1{padding:5px 20px;border-bottom:1px solid #ddd}\r\n.bindPhone .box .line_2,.bindPhone .box .line_3,#index_vue .bindPhone .box .line_4{height:70px;padding:10px}\r\n.bindPhone .box .line_2 input,.bindPhone .box .line_3 input{height:50px;width:100%;padding-left:16px}\r\n.bindPhone .box .line_3 input{width:58%}\r\n.bindPhone .box .line_3{padding-top:0}\r\n.bindPhone .box .line_4{padding:0 10px 0 10px}\r\n.bindPhone .box .line_4 span{display:block;width:50%;float:left;height:50px;line-height:50px;text-align:center}\r\n.bindPhone .box .line_4 span:nth-of-type(1){background:red;color:#fff}\r\n.bindPhone .box .line_4 span:nth-of-type(2){background:#f5f5f5}\r\n.bindPhone .box .line_3 span{display:block;width:40%;text-align:center;background:#aaa;height:50px;float:right;color:#fff;line-height:50px}\r\n</style>\r\n`;\r\n        let html=\r\n            [` \r\n<div class=\"bindPhone\">\r\n    <!--<div class=\"cover\" @touchstart=\"change('showBindPhoneView')\"></div>-->\r\n    <div class=\"box\" style=\"    display: block;\">\r\n        <div class=\"line_1\">\r\n            绑定手机号\r\n        </div>\r\n        <div class=\"line_2\">\r\n            <input placeholder=\"输入手机号\" v-model=\"phone\">\r\n        </div>\r\n        <div class=\"line_3\">\r\n            <input placeholder=\"输入验证码\" v-model=\"phoneCheck\">\r\n            <span @touchstart=\"sendPhoneCheck()\">{{checkText}}</span>\r\n        </div>\r\n        <div class=\"line_4\">\r\n            <span @click=\"bindPhone()\">确定</span>\r\n            <span @click=\"change('showBindPhoneView')\">取消</span>\r\n        </div>\r\n    </div>\r\n</div>\r\n`,`\r\n\r\n`];\r\n        super(hash, html, css);\r\n    }\r\n\r\n    vue_(){\r\n        this.vue = new VueP({\r\n            el: this.hash+'_vue',\r\n            created () {},\r\n            compiled () {},\r\n            data: {\r\n                showBindPhoneView:false,\r\n                canSendPhoneCheck:true,\r\n                checkText:'获取短信验证码',\r\n                phone:'',\r\n                phoneCheck:'',\r\n                timer12:null,\r\n            },\r\n            methods: {\r\n                init(){\r\n\r\n                },\r\n                sendPhoneCheck(){\r\n                    let dataStr = `{\r\n                        \"phone\":\"${this.phone}\"\r\n                    }`;\r\n                    let _this = this;\r\n                    Util.ajax(dataStr, `${db.data.api}getPhoneVerificationCode.php`, (data) => {\r\n                        if(data.e !== 0){\r\n                            if(!launcher.vue.handlerError(data.e))\r\n                                Message.toast('短信发送失败', 3);\r\n                        }else{\r\n                            _this.checkText = '60秒';\r\n                            if(_this.timer12 !== null){\r\n                                clearInterval(_this.timer12);\r\n                                _this.timer12 = null;\r\n                            }\r\n                            _this.timer12 = setInterval(function(){\r\n                                var num = Math.floor(_this.checkText.substr(0,_this.checkText.length-1))-1;\r\n                                if(num<0){\r\n                                    clearInterval(_this.timer12);\r\n                                    _this.timer12 = null;\r\n                                    _this.checkText = '获取短信验证码';\r\n                                }else{\r\n                                    _this.checkText = num + '秒';\r\n                                }\r\n                            },1000);\r\n                        }\r\n                    });\r\n                },\r\n                bindPhone(){\r\n                    if(!Util.isMobileNumber(this.phone))\r\n                        throw '手机号码格式错误';\r\n                    if(!!this.phoneCheck === false)\r\n                        throw '验证码格式错误';\r\n                    let dataStr = `{\r\n                        \"phone\":\"${this.phone}\",\r\n                        \"code\":\"${this.phoneCheck}\"\r\n                    }`;\r\n                    let _this = this;\r\n                    Util.ajax(dataStr, `${db.data.api}verifyPhoneCode.php`, (data) => {\r\n                        if(data.e !== 0){\r\n                            Message.toast('非授权用户', 3);\r\n                        }else{\r\n                            app.browser.die();\r\n                            clearInterval(_this.timer12);\r\n                            _this.timer12 = null;\r\n                            db.data.user.phone = _this.phone;\r\n                            _this.phone = '';\r\n                            _this.phoneCheck = '';\r\n                            _this.showBindPhoneView = false;\r\n                            _this.checkText = '获取短信验证码';\r\n                            Message.toast('绑定成功', 3);\r\n                            setTimeout(function(){\r\n                                location.href=`https://www.jianyuepai.com.cn/api/barber/login.php?clientType=wx&redirect=http://www.jianyuepai.com.cn/barber/index.php?hash=index`;\r\n                            },1000);\r\n                        }\r\n                    });\r\n                },\r\n            }\r\n        });\r\n    }\r\n}"]}